# 粒子解析プログラムの使い方ガイド

このプログラムは、顕微鏡写真のような専門的な画像（TIFF画像と呼ばれます）に写っているたくさんの小さな粒子を、自動で数えたり、大きさを測ったりするためのツールです。

複数の画像を一度にまとめて解析する「バッチ処理」機能が備わっており、たくさんのデータを効率的に扱えます。

このガイドでは、プログラミングに詳しくない方でも、手順通りに進めればプログラムを使えるように、丁寧に説明します。

## 1. 準備編：プログラムを動かす前に

まず、お使いのパソコンでプログラムを動かすための準備をします。

### ステップ1：プログラムをダウンロードする

はじめに、この粒子解析プログラムのファイル一式をお使いのパソコンにダウンロードします。

1.  **プログラムが配布されているWebページ（例: GitHub）にアクセスします。**
2.  **ファイル一式をZIPファイルとしてダウンロードします。**
    *   GitHubの場合、緑色の「Code」ボタンを押し、メニューから「Download ZIP」を選択するとダウンロードできます。
3.  **ダウンロードしたZIPファイルを解凍（展開）します。**
    *   ダウンロードしたファイル（例: `particle_analyze-main.zip`）をダブルクリックするか、右クリックメニューから「すべて展開」などを選んでください。
    *   解凍してできたフォルダ（例: `particle_analyze-main`）を、デスクトップなどの分かりやすい場所に置いてください。このフォルダがプログラムの本体になります。

### ステップ2：必要なものをインストールする

このプログラムは、いくつかの専門的な計算ツール（ライブラリと呼びます）の助けを借りて動きます。
以下の手順で、それらをパソコンにインストールしましょう。

1.  **ターミナル（またはコマンドプロンプト）を開きます。**
    *   **Macの場合:** `アプリケーション`フォルダの中の`ユーティリティ`フォルダにある`ターミナル.app`を開きます。
    *   **Windowsの場合:** スタートメニューで`cmd`と検索して、`コマンドプロンプト`を開きます。

2.  **以下の呪文（コマンド）をコピーして、ターミナルに貼り付け、Enterキーを押します。**
    これにより、必要なツールが一括でインストールされます。

    ```bash
    pip install opencv-python numpy matplotlib scikit-image scikit-learn tqdm
    ```

    （もし`pip`というコマンドが無いとエラーが出た場合は、先にPython本体のインストールが必要です。その際は別途ご相談ください。）

### ステップ3：解析したい画像を指定する

次に、あなたが解析したいご自身の画像ファイルを、プログラムに教えてあげる必要があります。

1.  **ステップ1で用意したプログラムのフォルダ（例: `particle_analyze-main`）の中にある`main.py`というファイルを開きます。**
    このファイルは、プログラムの設計図のようなものです。メモ帳やテキストエディタで開くことができます。

2.  **ファイルの中の`paths = [...]`と書かれている部分を探します。**
    はじめは、以下のように書かれているはずです。

    ```python
    paths = [
        "path/to/binary_image_stack_01.tif",
        "path/to/binary_image_stack_02.tif",
        "path/to/binary_image_stack_03.tif",
    ]
    ```

3.  **`"path/to/..."`の部分を、あなたが解析したい画像の場所（パス）に書き換えます。**
    ファイルのパスを一つ一つ指定することも、画像が入ったフォルダのパスを指定してまとめて処理することもできます。

    **書き換え方の例：**

    *   **ファイルを個別に指定する場合**
        カンマ`,`で区切って、解析したい画像をいくつでも追加できます。一つだけでも構いません。

        *   **Macの例:**
            （`your_username`の部分は、ご自身のユーザー名に置き換えてください）

            ```python
            paths = [
                "/Users/your_username/Desktop/image1.tif",
                "/Users/your_username/Desktop/image2.tif",
            ]
            ```

        *   **Windowsの例:**
            （`your_username`の部分は、ご自身のユーザー名に置き換えてください）

            ```python
            paths = [
                "C:/Users/your_username/Documents/image_A.tif",
                "C:/Users/your_username/Documents/image_B.tif",
            ]
            ```
            **（注意：Windowsの場合、パスの区切り文字`\`は`/`に置き換えてください）**

    *   **フォルダをまとめて指定する場合**
        特定のフォルダの中にある画像（`.tif`または`.tiff`）をすべて解析したい場合は、フォルダのパスを一つだけ指定します。
        
        ```python
        paths = [
            "/Users/your_username/Desktop/my_image_folder",
        ]
        ```
        このように指定すると、プログラムが自動でフォルダの中の画像を探して、すべて解析してくれます。

4.  **ファイルを上書き保存します。**

これで準備は完了です！

## 2. 実行編：プログラムを動かしてみる

いよいよプログラムを実行して、画像の解析を始めます。

1.  **準備編で使ったターミナル（またはコマンドプロンプト）を再度開きます。**

2.  **このプログラム（`particle_analyze`フォルダ）が置いてある場所に移動します。**
    （もし開き方が分からなければ、`particle_analyze`フォルダをターミナルのアイコンにドラッグ＆ドロップしてみてください）

3.  **以下の呪文（コマンド）をコピーして、ターミナルに貼り付け、Enterキーを押します。**

    ```bash
    python main.py
    ```

4.  **解析が始まります。** 進行状況を示すバーが表示され、パソコンが計算を頑張るので、少し時間がかかる場合があります。じっと待っていてください。
    ターミナルに特に何もエラーメッセージが表示されなければ、成功です。

## 3. 結果編：解析されたデータを見てみる

解析が終わると、`particle_analyze`フォルダの中に`dist`という新しいフォルダが作られ、その中に結果が保存されます。

`dist`フォルダの中は、さらに以下のように分かれています。

*   `dist/detected/`
    *   プログラムが「これが粒子だ」と認識した部分を、カラフルに色付けした画像が入っています。元画像と見比べて、正しく認識できているか確認できます。

*   `dist/segmented/`
    *   プログラムが粒子をどのように切り分けたかを示す、少し専門的な画像です。

*   `dist/histogram/`
    *   見つかった粒子の**大きさ（直径）** をグラフにした画像（ヒストグラム）です。どのくらいの大きさの粒子が、それぞれ何個くらいあったかが一目で分かります。

*   `dist/csv/`
    *   見つかった粒子一つ一つの**直径の生データ**が記録されたファイルです。Excelなどで開くことができ、ご自身でさらに詳しい分析をしたい場合に使えます。

*   `dist/summary/`
    *   各画像の解析結果をまとめた**サマリー（要約）ファイル**です。粒子の数、大きさの平均値・最大値・最小値などが記録されており、画像ごとの特徴を比較するのに便利です。

## 困ったときは

*   **エラーが出た:** ターミナルに表示されたエラーメッセージをコピーして、開発担当の方にご相談ください。
*   **設定を細かく変えたい:** `modules/config.py`というファイルを編集すると、解析の感度などを調整できますが、専門的な知識が必要です。まずは開発担当の方にご相談することをおすすめします。
