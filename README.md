# 粒子解析ツール

## 概要

このツールは、複数ページの TIFF 画像（画像スタック）を入力として、画像に含まれる粒子を検出し、それらの直径を解析します。解析結果として、粒子が検出された画像、直径のヒストグラム、および直径の生データを含む CSV ファイルを出力します。

## 機能

- **粒子検出**: Watershed アルゴリズムを用いて、画像スタックの各スライスから粒子をセグメンテーションします。
- **粒子追跡**: スライス間で粒子を追跡し、3 次元的な粒子として認識します。
- **直径計算**: 各粒子の直径を計算します。
- **結果出力**:
  - 検出粒子を色分けして表示した TIFF 画像
  - 粒子のセグメンテーション結果を示す TIFF 画像
  - 粒子直径の分布を示すヒストグラム画像（PNG 形式）
  - 各粒子の直径を記録した CSV ファイル

## 使い方

1. **設定**:

   - `main.py` の `paths` リストに、解析したい TIFF 画像のパスを追加します。
   - 必要に応じて、`modules/config.py` 内のパラメータを調整します。

2. **実行**:

   ```bash
   python main.py
   ```

3. **出力**:
   - 解析結果は `dist` ディレクトリ以下に、入力ファイル名に基づいて保存されます。
     - `dist/detected/`: 粒子検出後の色付け画像
     - `dist/segmented/`: セグメンテーション後の画像
     - `dist/histogram/`: 直径のヒストグラム
     - `dist/csv/`: 直径の CSV データ

## 依存関係

- Python 3
- OpenCV
- NumPy
- Matplotlib
- scikit-image
- scikit-learn
- tqdm

これらのライブラリは、pip でインストールできます。

```bash
pip install opencv-python numpy matplotlib scikit-image scikit-learn tqdm
```

## 注意事項

- 入力する TIFF 画像は、二値化されたものであることを想定しています。
  - 内部的に[大津の二値化](https://ja.wikipedia.org/wiki/%E5%A4%A7%E6%B4%A5%E3%81%AE%E4%BA%8C%E5%80%A4%E5%8C%96%E6%B3%95 "大津の二値化法")をしているため二値化しなくても一応動作はしますが、その場合は解析結果が妥当であるかを`dist/detected`などから確認してください。
- `main.py` で `auto_z=True` を設定すると、粒子が最初に現れるスライスの次のスライスが自動的に解析対象となります。特定の z スライスを解析したい場合は、`z` パラメータを指定してください。
